<!--
=======================================================
Budget Beyond - Base Layout Template
=======================================================
Main layout template that provides the structure for all pages
Features:
- Responsive Bootstrap 5.3.2 framework
- Dynamic dark/light theme system
- Animated navbar with dynamic page titles
- Authentication-aware navigation
=======================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Information -->
    <meta charset="UTF-8">
    <title>{% block title %}{% endblock %} - Budget Beyond</title>
    
    <!-- External Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    <!-- Theme Override Styles -->
    <style>
        /* Force override Bootstrap defaults for immediate theme application */
        body[data-bs-theme="dark"] {
            background-color: #121212 !important;
            color: #f1f1f1 !important;
        }
        
        body[data-bs-theme="light"] {
            background-color: #f8f9fa !important;
            color: #212529 !important;
        }
        
        [data-bs-theme="dark"] .container,
        [data-bs-theme="dark"] .container-fluid {
            background-color: transparent !important;
            color: #f1f1f1 !important;
        }
    </style>
</head>
<body data-bs-theme="light">

    <!-- =================================================================
         NAVIGATION BAR
         ================================================================= -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <!-- Brand with Dynamic Animation -->
            <a class="navbar-brand" href="{{ url_for('main.home') if session.get('user_id') else url_for('main.signin') }}">
                Budget Beyond{% block navbar_dynamic %}{% endblock %}
            </a>
            
            <!-- Authentication-Based Navigation -->
            {% if session.get('user_id') %}
                <!-- Authenticated User Navigation -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.home') }}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.settings') }}">Settings</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.logout') }}">Sign Out</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.expenses') }}">Expenses</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.bills') }}">Bills</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.tasks') }}">Tasks</a>
                        </li>
                    </ul>
                </div>
            {% else %}
                <!-- Unauthenticated User Navigation -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAuth" aria-controls="navbarNavAuth" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNavAuth">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.signin') }}">Sign In</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.signup') }}">Sign Up</a>
                        </li>
                    </ul>
                </div>
            {% endif %}
        </div>
    </nav>

    <!-- =================================================================
         MAIN CONTENT AREA
         ================================================================= -->
    <div class="container mt-4 page-content">
        {% block content %}{% endblock %}
    </div>

    <!-- =================================================================
         JAVASCRIPT LIBRARIES & CUSTOM SCRIPTS
         ================================================================= -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Theme initialization script -->
    <script>
        // Initialize theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-bs-theme', savedTheme);
            document.documentElement.setAttribute('data-bs-theme', savedTheme);
            
            // Force style refresh
            if (savedTheme === 'dark') {
                document.body.style.backgroundColor = '#121212';
                document.body.style.color = '#f1f1f1';
            } else {
                document.body.style.backgroundColor = '#f8f9fa';
                document.body.style.color = '#212529';
            }
        });
    </script>
    
    <script>
    /* ================================================================
       THEME MANAGEMENT SYSTEM
       ================================================================ */
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize theme from localStorage or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-bs-theme', savedTheme);
        document.documentElement.setAttribute('data-bs-theme', savedTheme);
        
        // Apply theme-specific styling immediately
        if (savedTheme === 'dark') {
            document.body.style.backgroundColor = '#121212';
            document.body.style.color = '#f1f1f1';
        } else {
            document.body.style.backgroundColor = '#f8f9fa';
            document.body.style.color = '#212529';
        }

        /* ============================================================
           DYNAMIC NAVBAR ANIMATION SYSTEM
           ============================================================ */
        
        /**
         * Animates the dynamic portion of the navbar title
         * Only animates the text after "Budget Beyond"
         */
        function animateDynamicNavbar() {
            const dynamicElement = document.getElementById('navbarDynamicText');
            if (dynamicElement && dynamicElement.textContent.trim()) {
                // Clean slide-in animation from below - quicker timing
                dynamicElement.style.animation = 'slideInFromBelow 1s ease-out forwards';
            }
        }
        
        // Initialize dynamic navbar animation on page load
        animateDynamicNavbar();
        
        /* ============================================================
           SMOOTH NAVIGATION TRANSITIONS
           ============================================================ */
        
        let isTransitioning = false;
        
        /**
         * Handles smooth navigation transitions
         * Slides out dynamic content before navigation
         * @param {Event} e - Click event
         */
        function handleSmoothNavigation(e) {
            if (isTransitioning) return;
            
            const targetHref = e.currentTarget.getAttribute('href');
            if (!targetHref || targetHref.startsWith('#')) return;
            
            // Only animate if there's dynamic content to animate
            const dynamicElement = document.getElementById('navbarDynamicText');
            if (!dynamicElement || !dynamicElement.textContent.trim()) {
                return; // Allow normal navigation
            }
            
            e.preventDefault();
            isTransitioning = true;
            
            // Slide out only the dynamic section
            dynamicElement.style.animation = 'slideOutDown 0.3s ease-in forwards';
            
            // Navigate after animation completes
            setTimeout(() => {
                window.location.href = targetHref;
            }, 300);
        }
        
        // Attach smooth navigation to navigation links
        const navigationLinks = document.querySelectorAll('.navbar-nav .nav-link');
        navigationLinks.forEach(link => {
            link.addEventListener('click', handleSmoothNavigation);
        });
    });
    </script>
</body>
</html>